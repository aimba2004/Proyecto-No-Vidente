<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Registro de Administrador - VisioGuide</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
  <style>
    :root {
      --primary: #4361ee;
      --primary-dark: #3a56d4;
      --secondary: #ff6b6b;
      --accent: #4cc9f0;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --success: #52b788;
      --error: #e5383b;
      --border-radius: 12px;
      --box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .app-container {
      width: 100%;
      max-width: 800px;
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    header {
      text-align: center;
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 15px;
    }

    .logo-icon {
      font-size: 2.5rem;
      color: var(--accent);
    }

    h1 {
      color: white;
      font-size: 2.2rem;
      font-weight: 700;
    }

    .tagline {
      color: rgba(255, 255, 255, 0.85);
      font-size: 1.1rem;
      margin-top: 10px;
    }

    .registration-section {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 40px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .section-title {
      color: var(--dark);
      font-size: 1.8rem;
      margin-bottom: 10px;
      position: relative;
      padding-bottom: 10px;
      text-align: center;
    }

    .section-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 4px;
      background: var(--primary);
      border-radius: 2px;
    }

    .admin-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #e6f7ff;
      color: #1890ff;
      padding: 8px 15px;
      border-radius: 30px;
      font-weight: 600;
      margin: 10px auto;
      border: 1px solid #91d5ff;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    label {
      font-weight: 600;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    label i {
      color: var(--primary);
    }

    .input-with-icon {
      position: relative;
    }

    input {
      width: 100%;
      padding: 15px 15px 15px 45px;
      border: 2px solid #e9ecef;
      border-radius: var(--border-radius);
      font-size: 1rem;
      transition: var(--transition);
    }

    input:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
    }

    .input-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      font-size: 1.2rem;
    }

    .password-container {
      position: relative;
    }

    .toggle-password {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--gray);
      cursor: pointer;
      font-size: 1.2rem;
    }

    .buttons-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 20px;
    }

    button {
      padding: 15px;
      border: none;
      border-radius: var(--border-radius);
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .register-btn {
      background: var(--primary);
      color: white;
    }

    .register-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    .login-btn {
      background: white;
      color: var(--primary);
      border: 2px solid var(--primary);
    }

    .login-btn:hover {
      background: #f0f5ff;
      transform: translateY(-2px);
    }

    #mensaje {
      min-height: 24px;
      padding: 15px;
      border-radius: var(--border-radius);
      text-align: center;
      font-weight: 500;
      transition: var(--transition);
      margin-top: 10px;
    }

    .error {
      background: rgba(229, 56, 59, 0.1);
      color: var(--error);
      border: 1px solid rgba(229, 56, 59, 0.2);
    }

    .success {
      background: rgba(82, 183, 136, 0.1);
      color: var(--success);
      border: 1px solid rgba(82, 183, 136, 0.2);
    }

    .password-strength {
      height: 6px;
      background: #e9ecef;
      border-radius: 3px;
      margin-top: 5px;
      overflow: hidden;
    }

    .strength-meter {
      height: 100%;
      width: 0;
      transition: width 0.3s ease;
      background: var(--error);
    }

    .strength-weak {
      background: var(--error);
      width: 33%;
    }

    .strength-medium {
      background: #ffc107;
      width: 66%;
    }

    .strength-strong {
      background: var(--success);
      width: 100%;
    }

    .password-hints {
      font-size: 0.85rem;
      color: var(--gray);
      margin-top: 5px;
    }

    .password-hints ul {
      padding-left: 20px;
      margin-top: 5px;
    }

    .password-hints li {
      margin-bottom: 3px;
    }

    .accessibility-section {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }

    .access-btn {
      background: rgba(67, 97, 238, 0.1);
      color: var(--primary);
      border: none;
      padding: 8px 15px;
      border-radius: 30px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
      cursor: pointer;
    }

    .access-btn:hover {
      background: rgba(67, 97, 238, 0.2);
    }

    footer {
      text-align: center;
      color: rgba(255, 255, 255, 0.7);
      padding: 20px;
      font-size: 0.9rem;
    }

    .high-contrast {
      --primary: #000000;
      --primary-dark: #000000;
      --secondary: #ffff00;
      --accent: #00ffff;
      --light: #ffffff;
      --dark: #000000;
      background: #ffffff;
      color: #000000 !important;
    }

    .high-contrast .registration-section {
      background: #ffffff;
      color: #000000 !important;
      border: 2px solid #000000;
    }

    .high-contrast .admin-badge {
      background: #ffffff;
      color: #000000 !important;
      border: 2px solid #000000;
    }

    .high-contrast .section-title {
      color: #000000;
    }

    .high-contrast label {
      color: #000000;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <header>
      <div class="logo">
        <i class="fas fa-eye-slash logo-icon"></i>
        <div>
          <h1>VisioGuide</h1>
        </div>
      </div>
    </header>

    <section class="registration-section">
      <h2 class="section-title">Crear Cuenta</h2>
      <div class="admin-badge">
        <i class="fas fa-user-shield"></i>
        <span>Asegúrese de proporcionar toda la información solicitada en el formulario de registro</span>
      </div>
      
      <div class="form-grid">
        <div class="form-group">
          <label for="nombre"><i class="fas fa-user"></i> Nombre</label>
          <div class="input-with-icon">
            <i class="fas fa-user input-icon"></i>
            <input type="text" id="nombre" placeholder="Ingresa tu nombre" autocomplete="given-name">
          </div>
        </div>
        
        <div class="form-group">
          <label for="apellido"><i class="fas fa-user"></i> Apellido</label>
          <div class="input-with-icon">
            <i class="fas fa-user input-icon"></i>
            <input type="text" id="apellido" placeholder="Ingresa tu apellido" autocomplete="family-name">
          </div>
        </div>
        
        <div class="form-group">
          <label for="cedula"><i class="fas fa-id-card"></i> Cédula</label>
          <div class="input-with-icon">
            <i class="fas fa-id-card input-icon"></i>
            <input type="text" id="cedula" placeholder="Ingresa tu cédula" autocomplete="off">
          </div>
        </div>
        
        <div class="form-group">
          <label for="direccion"><i class="fas fa-home"></i> Dirección</label>
          <div class="input-with-icon">
            <i class="fas fa-home input-icon"></i>
            <input type="text" id="direccion" placeholder="Ingresa tu dirección" autocomplete="street-address">
          </div>
        </div>
        
        <div class="form-group">
          <label for="telefono"><i class="fas fa-phone-alt"></i> Teléfono de emergencia</label>
          <div class="input-with-icon">
            <i class="fas fa-phone-alt input-icon"></i>
            <input type="text" id="telefono" placeholder="Ej. 0987654321" autocomplete="tel">
          </div>
        </div>
        
        <div class="form-group">
          <label for="email"><i class="fas fa-envelope"></i> Correo electrónico</label>
          <div class="input-with-icon">
            <i class="fas fa-envelope input-icon"></i>
            <input type="email" id="email" placeholder="usuario@ejemplo.com" autocomplete="email">
          </div>
        </div>
        
        <div class="form-group">
          <label for="password"><i class="fas fa-lock"></i> Contraseña</label>
          <div class="password-container">
            <div class="input-with-icon">
              <i class="fas fa-lock input-icon"></i>
              <input type="password" id="password" placeholder="Crea una contraseña segura" autocomplete="new-password">
            </div>
            <button class="toggle-password" id="togglePassword" aria-label="Mostrar contraseña">
              <i class="fas fa-eye"></i>
            </button>
          </div>
          <div class="password-strength">
            <div class="strength-meter" id="passwordStrength"></div>
          </div>
          <div class="password-hints">
            <p>La contraseña debe contener:</p>
            <ul>
              <li>Mínimo 8 caracteres</li>
              <li>Al menos una letra mayúscula</li>
              <li>Al menos un número</li>
              <li>Un carácter especial (ej. !@#$%)</li>
            </ul>
          </div>
        </div>
      </div>
      
      <div id="mensaje"></div>
      
      <div class="buttons-container">
        <button class="register-btn" onclick="registrar()">
          <i class="fas fa-user-plus"></i> Registrar
        </button>
        <button class="login-btn" onclick="window.location.href='index.html'">
          <i class="fas fa-sign-in-alt"></i> Volver al Login
        </button>
      </div>
      
      <div class="accessibility-section">
        <button class="access-btn" onclick="toggleContrast()">
          <i class="fas fa-adjust"></i> Alto Contraste
        </button>
        <button class="access-btn" onclick="increaseFontSize()">
          <i class="fas fa-text-height"></i> Aumentar Texto
        </button>
        <button class="access-btn" onclick="speakPage()">
          <i class="fas fa-volume-up"></i> Leer Instrucciones
        </button>
      </div>
    </section>

    <footer>
      <p>VisioGuide &copy; 2023 - Todos los derechos reservados</p>
      <p>Sistema de administración para asistencia a personas no videntes</p>
    </footer>
  </div>

  <script>
    // Configuración de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDHLdHbKhbvSg-ET9BKgPnKqqX0IagShac",
      authDomain: "proyectonovidente-d1e58.firebaseapp.com",
      databaseURL: "https://proyectonovidente-d1e58-default-rtdb.firebaseio.com",
      projectId: "proyectonovidente-d1e58",
      storageBucket: "proyectonovidente-d1e58.appspot.com",
      messagingSenderId: "1089641196998",
      appId: "1:1089641196998:web:f95785dec09af8136b56c7",
      measurementId: "G-PVFZ0EL8VQ"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    function registrar() {
      const nombre = document.getElementById("nombre").value.trim();
      const apellido = document.getElementById("apellido").value.trim();
      const cedula = document.getElementById("cedula").value.trim();
      const direccion = document.getElementById("direccion").value.trim();
      const telefono = document.getElementById("telefono").value.trim();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      const mensaje = document.getElementById("mensaje");

      // Validar campos obligatorios
      if (!nombre || !apellido || !cedula || !direccion || !telefono || !email || !password) {
        showMessage("Por favor, completa todos los campos.", "error");
        return;
      }

      // Validación de cédula (10 dígitos)
      if (!/^\d{10}$/.test(cedula)) {
        showMessage("La cédula debe tener 10 dígitos numéricos.", "error");
        return;
      }

      // Validación de teléfono (10 dígitos)
      if (!/^\d{10}$/.test(telefono)) {
        showMessage("El teléfono debe tener 10 dígitos.", "error");
        return;
      }

      // Validación de email
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showMessage("Por favor, ingresa un correo electrónico válido.", "error");
        return;
      }

      // Validación de contraseña
      if (password.length < 8) {
        showMessage("La contraseña debe tener al menos 8 caracteres.", "error");
        return;
      }
      
      if (!/[A-Z]/.test(password)) {
        showMessage("La contraseña debe contener al menos una letra mayúscula.", "error");
        return;
      }
      
      if (!/\d/.test(password)) {
        showMessage("La contraseña debe contener al menos un número.", "error");
        return;
      }
      
      if (!/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
        showMessage("La contraseña debe contener al menos un carácter especial.", "error");
        return;
      }

      showMessage("Registrando...", "success");

      // Crear usuario con Firebase Authentication
      auth.createUserWithEmailAndPassword(email, password)
        .then(userCredential => {
          const uid = userCredential.user.uid;

          // Crear objeto de usuario (todos serán Administradores)
          const nuevoUsuario = {
            nombre: nombre,
            apellido: apellido,
            cedula: cedula,
            direccion: direccion,
            telefonoEmergencia: telefono,
            tipo: "Administrador", // Asignación automática como Administrador
            email: email
          };

          // Guardar en Firebase Realtime Database
          database.ref("usuarios/" + uid).set(nuevoUsuario)
            .then(() => {
              showMessage("Administrador registrado exitosamente. Redirigiendo...", "success");

              // Redirección después de 2 segundos
              setTimeout(() => {
                window.location.href = "registro.html"; // Página de administración
              }, 2000);
            })
            .catch(error => {
              showMessage("Error al guardar en la base de datos: " + error.message, "error");
            });
        })
        .catch(error => {
          showMessage("Error en el registro: " + error.message, "error");
        });
    }

    // Mostrar mensajes en la interfaz
    function showMessage(text, type) {
      const mensaje = document.getElementById("mensaje");
      mensaje.textContent = text;
      mensaje.className = type;
    }

    // Alternar visibilidad de contraseña
    document.getElementById("togglePassword").addEventListener("click", function() {
      const passwordInput = document.getElementById("password");
      const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
      passwordInput.setAttribute("type", type);
      
      // Cambiar icono
      this.innerHTML = type === "password" ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
      this.setAttribute("aria-label", type === "password" ? "Mostrar contraseña" : "Ocultar contraseña");
    });

    // Indicador de fortaleza de contraseña
    document.getElementById("password").addEventListener("input", function() {
      const password = this.value;
      const strengthMeter = document.getElementById("passwordStrength");
      
      // Resetear clases
      strengthMeter.className = "strength-meter";
      
      if (password.length === 0) {
        strengthMeter.style.width = "0";
        return;
      }
      
      // Calcular fortaleza
      let strength = 0;
      
      // Longitud mínima
      if (password.length >= 8) strength += 1;
      
      // Contiene mayúsculas
      if (/[A-Z]/.test(password)) strength += 1;
      
      // Contiene números
      if (/\d/.test(password)) strength += 1;
      
      // Contiene caracteres especiales
      if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) strength += 1;
      
      // Actualizar visualización
      if (strength < 2) {
        strengthMeter.classList.add("strength-weak");
      } else if (strength < 4) {
        strengthMeter.classList.add("strength-medium");
      } else {
        strengthMeter.classList.add("strength-strong");
      }
    });

    // Permitir registro con Enter
    document.getElementById("password").addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        registrar();
      }
    });

    // Funciones de accesibilidad
    function toggleContrast() {
      document.body.classList.toggle("high-contrast");
      speak("Modo alto contraste " + (document.body.classList.contains("high-contrast") ? "activado" : "desactivado"));
    }

    function increaseFontSize() {
      document.body.style.fontSize = parseFloat(getComputedStyle(document.body).fontSize) * 1.1 + "px";
      speak("Tamaño de texto aumentado");
    }

    function speakPage() {
      const title = document.querySelector(".section-title").textContent;
      const badge = document.querySelector(".admin-badge span").textContent;
      const instructions = "Complete todos los campos para registrar un nuevo administrador. La contraseña debe tener al menos 8 caracteres, incluir una letra mayúscula, un número y un carácter especial.";
      
      speak(title + ". " + badge + ". " + instructions);
    }

    function speak(text) {
      if ("speechSynthesis" in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = "es-ES";
        utterance.rate = 1.0;
        utterance.pitch = 1.0;
        speechSynthesis.speak(utterance);
      }
    }
  </script>
</body>
</html>